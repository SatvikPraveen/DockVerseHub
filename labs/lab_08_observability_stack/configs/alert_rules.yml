groups:
- name: application_alerts
  interval: 10s
  rules:
  # Availability alerts
  - alert: HighErrorRate
    expr: |
      (sum(rate(app_errors_total[5m])) / sum(rate(app_requests_total[5m])))
      > 0.05
    for: 2m
    labels:
      severity: warning
      slo: availability
    annotations:
      summary: "High error rate detected ({{ $value | humanizePercentage }})"
      description: "Error rate {{ $value | humanizePercentage }} exceeds 5% threshold"

  - alert: CriticalErrorRate
    expr: |
      (sum(rate(app_errors_total[5m])) / sum(rate(app_requests_total[5m])))
      > 0.10
    for: 1m
    labels:
      severity: critical
      slo: availability
    annotations:
      summary: "CRITICAL: Error rate very high ({{ $value | humanizePercentage }})"
      description: "Error rate {{ $value | humanizePercentage }} exceeds 10% threshold"

  # Latency alerts
  - alert: HighLatency
    expr: histogram_quantile(0.95, rate(app_request_duration_ms_bucket[5m])) > 500
    for: 5m
    labels:
      severity: warning
      slo: latency
    annotations:
      summary: "High latency detected (P95: {{ $value }}ms)"
      description: "P95 latency {{ $value }}ms exceeds 500ms threshold"

  - alert: CriticalLatency
    expr: histogram_quantile(0.95, rate(app_request_duration_ms_bucket[5m])) > 1000
    for: 2m
    labels:
      severity: critical
      slo: latency
    annotations:
      summary: "CRITICAL: Latency very high (P95: {{ $value }}ms)"
      description: "P95 latency {{ $value }}ms exceeds 1000ms threshold"

  # Service availability
  - alert: ServiceDown
    expr: up{job="api"} == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "Service is down"
      description: "API service has been unreachable for more than 1 minute"

  # Resource alerts
  - alert: HighActiveRequests
    expr: app_active_requests > 50
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "High number of active requests ({{ $value }})"
      description: "{{ $value }} requests currently active"

  # Error budget
  - alert: ErrorBudgetLow
    expr: |
      (1 - (sum(rate(app_requests_total{status="200"}[5m])) / sum(rate(app_requests_total[5m]))))
      > 0.002
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Error budget running low"
      description: "Current error rate {{ $value | humanizePercentage }} threatens SLO"
